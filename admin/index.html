<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Flintlock Financing | Admin</title>
  <meta name="description" content="Flintlock Financing admin console (demo)."/>
  <style>
    :root{
      --bg0:#050F1B; --bg1:#061424; --bg2:#071726;
      --panel: rgba(255,255,255,0.06);
      --panel2: rgba(255,255,255,0.04);
      --text: rgba(255,255,255,0.92);
      --muted: rgba(255,255,255,0.70);
      --muted2: rgba(255,255,255,0.55);
      --line: rgba(255,255,255,0.12);
      --accent:#C57B2A;
      --radius:18px; --max:980px;
      --shadow: 0 18px 40px rgba(0,0,0,0.40);
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --focus: rgba(197,123,42,0.35);
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:var(--sans); color:var(--text);
      background:
        radial-gradient(900px 420px at 18% 0%, rgba(197,123,42,0.18), transparent 55%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg2) 55%, var(--bg0) 100%);
    }
    .container{max-width:var(--max); margin:0 auto; padding: 22px 18px}
    .top{display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap}
    .brand{display:flex; align-items:center; gap:10px}
    .mark{width:32px;height:32px;border-radius:10px;background:linear-gradient(180deg, rgba(197,123,42,0.95), rgba(197,123,42,0.35));border:1px solid rgba(255,255,255,0.15); box-shadow:0 10px 22px rgba(197,123,42,0.25)}
    .title{display:flex; flex-direction:column; line-height:1.1}
    .title strong{letter-spacing:0.08em; text-transform:uppercase; font-size:12px}
    .title span{font-size:12px; color:rgba(255,255,255,0.55)}
    .btn{
      display:inline-flex; align-items:center; justify-content:center;
      padding:10px 13px; border-radius:12px;
      border:1px solid rgba(255,255,255,0.16);
      background: rgba(255,255,255,0.06);
      color: rgba(255,255,255,0.92);
      font-size:13px; cursor:pointer; user-select:none; text-decoration:none;
    }
    .btn.primary{border-color: rgba(197,123,42,0.55); background: linear-gradient(180deg, rgba(197,123,42,0.95), rgba(197,123,42,0.55)); color:#0b1016; font-weight:900}
    .card{margin-top:16px; background: linear-gradient(180deg, var(--panel) 0%, var(--panel2) 100%); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow); padding:16px}
    h1{margin:14px 0 6px; font-size:20px}
    p{margin:0 0 12px; color:var(--muted)}
    .grid2{display:grid; grid-template-columns: 1fr 1fr; gap:12px}
    label{font-size:12px; color:var(--muted2)}
    .field{display:flex; flex-direction:column; gap:6px}
    input{
      padding:10px 12px; border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.18);
      color: rgba(255,255,255,0.92);
      outline:none;
      font-size:14px;
      font-family: var(--mono);
    }
    input:focus{border-color: rgba(197,123,42,0.50); box-shadow: 0 0 0 3px var(--focus)}
    .note{
      margin-top: 12px;
      padding: 12px 14px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,0.12);
      background: rgba(255,255,255,0.03);
      color: rgba(255,255,255,0.62);
      font-size: 12px;
    }
    @media(max-width:900px){ .grid2{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="container">
    <div class="top">
      <div class="brand">
        <div class="mark"></div>
        <div class="title">
          <strong>Flintlock Financing</strong>
          <span>Admin console (demo)</span>
        </div>
      </div>
      <div style="display:flex; gap:10px; flex-wrap:wrap;">
        <a class="btn" href="/app/">Open app</a>
        <a class="btn" href="/">Home</a>
      </div>
    </div>

    <div class="card">
      <h1>Policy controls</h1>
      <p>Edits are stored in your browser (localStorage) for demo/testing. Not production controls.</p>

      <div class="grid2">
        <div class="field">
          <label>Minimum score</label>
          <input id="minScore" type="number" min="300" max="850" step="1"/>
        </div>
        <div class="field">
          <label>Max ticket (item price)</label>
          <input id="maxTicket" type="number" min="0" step="1"/>
        </div>

        <div class="field">
          <label>Term cap ≤ $1,500 (months)</label>
          <input id="term1" type="number" min="1" max="84" step="1"/>
        </div>
        <div class="field">
          <label>Term cap ≤ $2,500 (months)</label>
          <input id="term2" type="number" min="1" max="84" step="1"/>
        </div>

        <div class="field">
          <label>Term cap > $2,500 (months)</label>
          <input id="term3" type="number" min="1" max="84" step="1"/>
        </div>
        <div class="field">
          <label>Money factor (illustrative)</label>
          <input id="moneyFactor" type="number" step="0.0001"/>
        </div>

        <div class="field">
          <label>Residual percent (e.g., 0.20 = 20%)</label>
          <input id="residualPct" type="number" step="0.01"/>
        </div>
        <div class="field">
          <label>Residual floor ($)</label>
          <input id="residualFloor" type="number" min="0" step="1"/>
        </div>
      </div>

      <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px;">
        <button class="btn primary" id="btnSave">Save policy</button>
        <button class="btn" id="btnReset">Reset to defaults</button>
        <button class="btn" id="btnExport">Export policy (JSON)</button>
      </div>

      <div class="note">
        <strong>Tip:</strong> After saving, open /app and refresh to pick up the updated policy values.
      </div>
    </div>
  </div>

<script>
(() => {
  const ADMIN_POLICY_KEY = "flintlock_demo_policy_v1";
  const DEFAULT_POLICY = {
    minScore: 620,
    maxTicket: 12000,
    termCaps: [
      { max: 1500, term: 24 },
      { max: 2500, term: 36 },
      { max: Infinity, term: 48 }
    ],
    residualPct: 0.20,
    residualFloor: 200,
    moneyFactor: 0.0030
  };

  function loadPolicy(){
    try{
      const raw = localStorage.getItem(ADMIN_POLICY_KEY);
      if(!raw) return JSON.parse(JSON.stringify(DEFAULT_POLICY));
      const p = JSON.parse(raw);
      return {
        minScore: Number(p.minScore ?? DEFAULT_POLICY.minScore),
        maxTicket: Number(p.maxTicket ?? DEFAULT_POLICY.maxTicket),
        termCaps: Array.isArray(p.termCaps) ? p.termCaps : JSON.parse(JSON.stringify(DEFAULT_POLICY.termCaps)),
        residualPct: Number(p.residualPct ?? DEFAULT_POLICY.residualPct),
        residualFloor: Number(p.residualFloor ?? DEFAULT_POLICY.residualFloor),
        moneyFactor: Number(p.moneyFactor ?? DEFAULT_POLICY.moneyFactor)
      };
    }catch(e){
      return JSON.parse(JSON.stringify(DEFAULT_POLICY));
    }
  }

  function setInputs(p){
    document.getElementById("minScore").value = p.minScore;
    document.getElementById("maxTicket").value = p.maxTicket;
    document.getElementById("term1").value = Number(p.termCaps?.[0]?.term ?? 24);
    document.getElementById("term2").value = Number(p.termCaps?.[1]?.term ?? 36);
    document.getElementById("term3").value = Number(p.termCaps?.[2]?.term ?? 48);
    document.getElementById("moneyFactor").value = p.moneyFactor;
    document.getElementById("residualPct").value = p.residualPct;
    document.getElementById("residualFloor").value = p.residualFloor;
  }

  function readInputs(){
    const t1 = Number(document.getElementById("term1").value || 24);
    const t2 = Number(document.getElementById("term2").value || 36);
    const t3 = Number(document.getElementById("term3").value || 48);
    return {
      minScore: Number(document.getElementById("minScore").value || 620),
      maxTicket: Number(document.getElementById("maxTicket").value || 12000),
      termCaps: [
        { max: 1500, term: t1 },
        { max: 2500, term: t2 },
        { max: Infinity, term: t3 }
      ],
      moneyFactor: Number(document.getElementById("moneyFactor").value || 0.0030),
      residualPct: Number(document.getElementById("residualPct").value || 0.20),
      residualFloor: Number(document.getElementById("residualFloor").value || 200)
    };
  }

  function download(filename, text, mime){
    const blob = new Blob([text], {type: mime || "text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url; a.download = filename;
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  }

  setInputs(loadPolicy());

  document.getElementById("btnSave").addEventListener("click", () => {
    const p = readInputs();
    localStorage.setItem(ADMIN_POLICY_KEY, JSON.stringify(p));
    alert("Saved. Open /app and refresh to apply.");
  });

  document.getElementById("btnReset").addEventListener("click", () => {
    localStorage.setItem(ADMIN_POLICY_KEY, JSON.stringify(DEFAULT_POLICY));
    setInputs(DEFAULT_POLICY);
    alert("Reset to defaults.");
  });

  document.getElementById("btnExport").addEventListener("click", () => {
    const p = readInputs();
    download("flintlock_policy.json", JSON.stringify(p, null, 2), "application/json");
  });
})();
</script>
</body>
</html>
